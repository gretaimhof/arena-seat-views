<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Arena Seat Views — Pannellum</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css">
<script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

<style>
:root{
  --bg:#00243C; --ink:#0a2540; --text:#111;
  --banner-offset:325px;
}

html,body{
  height:100%; margin:0;
  font-family:'Roboto Condensed',system-ui,sans-serif;
  color:var(--text); background:var(--bg);
}
*{ border-radius:0!important; }
.pin,.pnlm-compass{ border-radius:50%!important; }

/* ========== LAYERED STRUCTURE ========== */
#mapView, #viewerView {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
}
#mapView { z-index: 1; }
#viewerView {
  z-index: 3;
  display: none;
  opacity: 0;
  pointer-events: none;
  transition: opacity .3s ease;
  align-items: center;
  justify-content: center;
}
#viewerView.show {
  display: flex;
  opacity: 1;
  pointer-events: auto;
}

/* Overlay (optional) */
#overlay {
  position: fixed;
  inset: 0;
  z-index: 2;
  background: rgba(0,0,0,0.45);
  opacity: 0;
  display: none;
  transition: opacity .3s ease;
  pointer-events: none;
}
#overlay.show {
  display: block;
  opacity: 1;
}

/* ========== MAP CARD ========== */
.map-card {
  position: relative;
  width: 100vw;
  height: 100vh;
  background: url("images/seating_chart_small.jpg") center center / contain no-repeat;
  /* Use 'cover' instead of 'contain' if you prefer full-fill cropping */
  background-color: #00243C;
  overflow: hidden;
}

/* Dropdown inside the map */
.section-panel.inside {
  position: absolute;
  top: 20px; left: 20px;
  width: 260px; max-height: 70vh; overflow-y: auto;
  background: #36BFED; border: 1px solid #36BFED;
  box-shadow: 0 8px 24px rgba(0,0,0,.18);
  z-index: 4;
}
.section-panel.inside .panel-header {
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 14px; margin:10px; height:48px;
  font-weight:900; color:var(--ink);
  background:#fff; border:0; cursor:pointer; width:calc(100% - 20px);
}
.section-panel.inside .panel-list{ display:none; padding:6px 10px 14px 10px; }
.section-panel.inside:not(.collapsed) .panel-list{ display:block; }
.section-panel.inside.collapsed .chev{ transform: rotate(-90deg); }

.section-item {
  display:flex; align-items:center; justify-content:space-between;
  padding:10px 12px; margin:6px 8px; font-weight:700; color:var(--ink);
  background:#fff; border:1px solid rgba(10,37,64,.08);
  cursor:pointer; user-select:none;
  transition: background .2s ease, transform .05s ease;
}
.section-item:hover { background:#cde8fa; }
.section-item.active { background:#a9d6f7; border-color:var(--ink); }

/* Grouped sections inside the dropdown */
.section-group{
  margin:8px 6px 14px 6px;
  border:1px solid rgba(10,37,64,.08);
  background:#fff;
}
.group-header{
  display:flex; align-items:center; justify-content:space-between;
  width:100%;
  padding:10px 12px;
  font-weight:900; letter-spacing:.04em;
  color:var(--ink);
  text-transform:uppercase;
  cursor:pointer;
  background:#fff; border:0;
}
.group-header .group-chev{ transition: transform .2s ease; }
.section-group.collapsed .group-chev{ transform: rotate(-90deg); }
.group-list{ padding:6px 8px 10px 8px; display:block; }
.section-group.collapsed .group-list{ display:none; }


/* Pins */
.pin {
  position:absolute;
  left:var(--x); top:var(--y);
  transform:translate(-50%,-50%);
  width:18px; height:18px;
  border:2px solid #fff; background:#e63946;
  cursor:pointer; transition:transform .15s ease;
  pointer-events:auto;
  z-index:3;
}
.pin:hover { transform:translate(-50%,-50%) scale(1.2); }

/* Decorative title */
.side-title {
  position: fixed; top: 50%; right: 0;
  transform: translateX(var(--banner-offset)) translateY(-50%) rotate(270deg);
  font-weight: 900; font-size: 60px; letter-spacing: .4em;
  color: #fff; text-shadow: 0 0 15px rgba(255,60,60,.6), 0 0 30px rgba(255,0,0,.4);
  text-transform: uppercase; user-select: none;
  pointer-events: none;
  z-index: 1;
}

/* ========== VIEWER ========== */
.pano-card {
  position: relative;
  width: min(1100px, 90vw);
  aspect-ratio: 16/9;
  overflow: hidden;
  background: #000;
  box-shadow: 0 12px 42px rgba(0,0,0,.35);
}
#panorama { position: absolute; inset: 0; }

.topbar {
  position:absolute; top:16px; left:42px; right:36px;
  display:flex; justify-content:space-between; align-items:center;
  pointer-events:none;
}
.back {
  pointer-events:auto; background:#111; color:#fff;
  border:1px solid rgba(255,255,255,.2);
  padding:.55rem .9rem; cursor:pointer;
}
.back:hover { background:#222; }
.label {
  pointer-events:auto;
  position:absolute; top:0; right:0px;
  background:rgba(0,0,0,.55);
  color:#fff; padding:.55rem .9rem;
  font-weight:700; white-space:nowrap;
}
</style>
</head>

<body>
<div id="overlay"></div>

<!-- ===== MAP VIEW ===== -->
<section id="mapView">
  <div class="map-card">

    <!-- Dropdown -->
    <aside class="section-panel inside collapsed" id="sectionPanelMap">
      <button class="panel-header" id="dropdownBtnMap" type="button">
        <span>SECTIONS</span><span class="chev">▾</span>
      </button>
      <div class="panel-list" id="sectionListMap"></div>
    </aside>

    <!-- Pins -->
    <button class="pin" style="--x:32%;--y:33%" data-key="section0" title="Section 100"></button>
    <button class="pin" style="--x:40%;--y:33%" data-key="section1" title="Section 101"></button>
    <button class="pin" style="--x:50%;--y:33%" data-key="section2" title="Section 102"></button>
    <button class="pin" style="--x:60%;--y:33%" data-key="section3" title="Section 103"></button>
    <button class="pin" style="--x:69%;--y:33%" data-key="section4" title="Section 104"></button>
    <button class="pin" style="--x:77%;--y:33%" data-key="section5" title="Section 105"></button>
  </div>
</section>

<div class="side-title">ROCK&nbsp;LOBSTERS</div>

<!-- ===== VIEWER VIEW (no dropdown) ===== -->
<section id="viewerView">
  <div class="pano-card">
    <div id="panorama"></div>
    <div class="topbar">
      <button class="back" id="backBtn">← Back to Map</button>
      <div class="label" id="sectionLabel">Section</div>
    </div>
  </div>
</section>

<script>
const scenes = {
  section0:{ image:'images/section0.JPG',  label:'Section 100' },
  section1:{ image:'images/section1.JPG',  label:'Section 101' },
  section2:{ image:'images/section2.JPG',  label:'Section 102' },
  section3:{ image:'images/section3.JPG',  label:'Section 103' },
  section4:{ image:'images/section4.JPG',  label:'Section 104' },
  section5:{ image:'images/section5.JPG',  label:'Section 105' }
};

let viewer = null;
const overlayEl = document.getElementById('overlay');
const viewerView = document.getElementById('viewerView');

function showViewer(){
  viewerView.classList.add('show');
  overlayEl.classList.add('show');
}
function hideViewer(){
  viewerView.classList.remove('show');
  overlayEl.classList.remove('show');
}

function switchScene(key){
  const scene = scenes[key];
  if(!scene) return;
  viewer = pannellum.viewer('panorama', {
    type:'equirectangular',
    panorama:scene.image,
    autoLoad:true,
    showZoomCtrl:true,
    hfov:100
  });
  document.getElementById('sectionLabel').textContent = scene.label;
  showViewer();
}

/* Build dropdown list */
function populateSectionPanelGrouped(listElId, { collapseAll = true } = {}) {
  const listEl = document.getElementById(listElId);
  if (!listEl) return;
  listEl.innerHTML = '';

  // bucket scenes by first digit (only 100s / 200s asked for)
  const groups = { '100s': [], '200s': [] };

  Object.entries(scenes).forEach(([key, data]) => {
    const label = data?.label || '';
    const m = label.match(/(\d+)/);
    if (!m) return;                             // skip if no number
    const num = parseInt(m[1], 10);
    const first = String(num)[0];
    const gk = first === '1' ? '100s' : first === '2' ? '200s' : null;
    if (!gk) return;                            // ignore 300s/other for now
    groups[gk].push({ key, num, label });
  });

  ['100s', '200s'].forEach(gk => {
    if (!groups[gk].length) return;
    groups[gk].sort((a,b) => a.num - b.num);

    // group wrapper
    const wrap = document.createElement('div');
    wrap.className = 'section-group' + (collapseAll ? ' collapsed' : '');

    // clickable header
    const header = document.createElement('button');
    header.type = 'button';
    header.className = 'group-header';
    header.innerHTML = `<span>${gk}</span><span class="group-chev">▾</span>`;
    header.addEventListener('click', () => wrap.classList.toggle('collapsed'));

    // list container
    const list = document.createElement('div');
    list.className = 'group-list';

    // items
    groups[gk].forEach(it => {
      const item = document.createElement('div');
      item.className = 'section-item';
      item.innerHTML = `<span class="num">${it.num}</span>`;
      item.addEventListener('click', () => switchScene(it.key));
      list.appendChild(item);
    });

    wrap.appendChild(header);
    wrap.appendChild(list);
    listEl.appendChild(wrap);
  });
}

/* Setup after DOM loaded */
window.addEventListener('DOMContentLoaded', ()=>{
  populateSectionPanelGrouped('sectionListMap');

  document.querySelectorAll('.pin').forEach(pin=>{
    pin.addEventListener('click', ()=> switchScene(pin.dataset.key));
  });

  document.getElementById('dropdownBtnMap')
    .addEventListener('click', ()=>{
      document.getElementById('sectionPanelMap').classList.toggle('collapsed');
    });

  document.getElementById('backBtn')
    .addEventListener('click', hideViewer);
});
</script>
</body>
</html>
