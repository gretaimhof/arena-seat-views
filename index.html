<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />

<!-- Disable mobile pinch zoom only -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<title>Arena Seat Views</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.css">
<script src="https://cdn.jsdelivr.net/npm/pannellum@2.5.6/build/pannellum.js"></script>

<style>
html, body {
    margin: 0;
    padding: 0;
    background: #00243C;
    font-family: "Roboto Condensed", sans-serif;
    overflow: hidden;
}

/* Make sure viewer UI uses Roboto */
#viewer-modal,
#viewer-box,
#panorama,
#section-title,
#back-btn {
    font-family: "Roboto Condensed", sans-serif !important;
}

/* Background Map */
#map-wrapper {
    position: fixed;
    inset: 0;
}
#seating-bg {
    position: absolute;
    inset: 0;
    width: 100vw;
    height: 100vh;
    object-fit: contain;
    pointer-events: none;
}

/* SVG overlay */
#overlay-container {
    position: absolute;
    inset: 0;
}
#overlay-svg {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
}
#overlay-svg path {
    fill: rgba(255, 255, 255, 0);
    transition: .25s;
    stroke: none !important;
}
#overlay-svg path:hover {
    fill: rgba(255, 255, 255, 0.542);
    cursor: pointer;
}

/* Tooltip */
#row-tooltip {
    position: fixed;
    padding: 6px 10px;
    background: rgba(0,0,0,0.75);
    color: white;
    font-size: 16px;
    border-radius: 6px;
    opacity: 0;
    pointer-events: none;
    transform: translate(-50%, -120%);
    transition: opacity .15s ease;
    z-index: 9999;
}

/* PANORAMA VIEWER */
#viewer-modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.75);
    display: none;
    opacity: 0;
    align-items: center;
    justify-content: center;
    transition: opacity .3s ease;
    cursor: pointer;
}
#viewer-modal.show {
    display: flex;
    opacity: 1;
}

#viewer-box {
    width: min(1100px, 90vw);
    aspect-ratio: 16/9;
    background: #000;
    position: relative;
    border-radius: 6px;
    cursor: default;
}
#panorama {
    position: absolute;
    inset: 0;
}

/* Back Button */
#back-btn {
    position: absolute;
    top: 12px;
    left: 40px;
    background: rgba(54,191,237,0.78);
    color: white;
    border: none;
    padding: 10px 16px;
    font-size: 18px;
    font-weight: 700;
    cursor: pointer;
    z-index: 40;
    backdrop-filter: blur(6px);
    transition: .25s;
}
#back-btn:hover {
    background: rgba(54,191,237,0.92);
}

/* Section Label */
#section-title {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 8px 16px;
    background: rgba(54,191,237,0.78);
    color: white;
    font-size: 22px;
    font-weight: 700;
    z-index: 40;
    pointer-events: none;
}
</style>
</head>

<body>

<div id="map-wrapper">
    <img id="seating-bg" src="images/seating_chart.png" alt="">
    <div id="overlay-container"></div>
    <div id="row-tooltip"></div>
</div>

<!-- VIEWER -->
<div id="viewer-modal">
    <div id="viewer-box" onclick="event.stopPropagation()">
        <div id="section-title"></div>
        <button id="back-btn">← Back</button>
        <div id="panorama"></div>
    </div>
</div>

<script>
/* Load SVG and apply hover + tooltip + click */
fetch("images/map_overlay.svg")
    .then(res => res.text())
    .then(svgText => {
        document.getElementById("overlay-container").innerHTML = svgText;

        const svg = document.querySelector("#overlay-container svg");
        svg.id = "overlay-svg";

        const tooltip = document.getElementById("row-tooltip");

        svg.querySelectorAll("path").forEach(path => {
            path.addEventListener("click", () => openPanorama(path.id));

            path.addEventListener("mouseenter", () => {
                const rows = path.id.split("_")[1];
                tooltip.innerText = rows.toUpperCase();
                tooltip.style.opacity = 1;
            });

            path.addEventListener("mousemove", e => {
                tooltip.style.left = e.clientX + "px";
                tooltip.style.top = e.clientY + "px";
            });

            path.addEventListener("mouseleave", () => {
                tooltip.style.opacity = 0;
            });
        });
    });

/* Open panorama */
function openPanorama(pathId) {
    const [sec, rows] = pathId.split("_");
    const file = `images/${sec}/${pathId}.jpg`;

    document.getElementById("section-title").innerText =
        `SECTION ${sec} • ROWS ${rows.toUpperCase()}`;

    const modal = document.getElementById("viewer-modal");
    modal.style.display = "flex";
    setTimeout(() => modal.classList.add("show"), 10);

    document.getElementById("panorama").innerHTML = "";
    if (window.viewer) viewer.destroy();

    window.viewer = pannellum.viewer("panorama", {
        type: "equirectangular",
        panorama: file,
        autoLoad: true,
        showControls: true,
        hfov: 100,
        compass: false
    });
}

/* Close viewer */
function closeViewer() {
    const modal = document.getElementById("viewer-modal");
    modal.classList.remove("show");
    setTimeout(() => modal.style.display = "none", 300);

    if (window.viewer) viewer.destroy();
}

document.getElementById("back-btn").addEventListener("click", closeViewer);
document.getElementById("viewer-modal").addEventListener("click", closeViewer);
</script>

</body>
</html>
